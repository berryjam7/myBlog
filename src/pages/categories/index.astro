---
import { getCollection } from 'astro:content';
import PageLayout from '../../layouts/PageLayout.astro';

const allPosts = await getCollection('blog', ({ data }) => !data.draft);

// Get all categories with post counts
const categoryMap = new Map<string, number>();
allPosts.forEach(post => {
  const category = post.data.category;
  categoryMap.set(category, (categoryMap.get(category) || 0) + 1);
});

const categories = Array.from(categoryMap.entries())
  .sort((a, b) => b[1] - a[1]); // Sort by count descending
---

<PageLayout 
  title="카테고리"
  description="블로그의 모든 카테고리를 둘러보세요."
>
  <div class="categories-page">
    <header class="page-header">
      <h1>카테고리</h1>
      <p>총 {categories.length}개의 카테고리</p>
    </header>
    
    <div class="category-grid">
      {categories.map(([category, count]) => (
        <a href={`/categories/${category}`} class="category-card card">
          <div class="category-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
            </svg>
          </div>
          <h3 class="category-name">{category}</h3>
          <p class="category-count">{count}개의 포스트</p>
        </a>
      ))}
    </div>
  </div>
</PageLayout>

<style>
  .page-header {
    text-align: center;
    margin-bottom: 3rem;
  }
  
  .page-header h1 {
    font-size: 2.5rem;
    margin-bottom: 0.5rem;
  }
  
  .page-header p {
    color: var(--text-secondary);
    font-size: 1.125rem;
  }
  
  .category-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 1.5rem;
  }
  
  .category-card {
    text-align: center;
    padding: 2rem;
    text-decoration: none;
    color: inherit;
  }
  
  .category-icon {
    width: 64px;
    height: 64px;
    margin: 0 auto 1rem;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, var(--primary-light), var(--primary));
    border-radius: var(--radius-full);
    color: white;
  }
  
  .category-name {
    font-size: 1.5rem;
    margin-bottom: 0.5rem;
    color: var(--text-primary);
  }
  
  .category-count {
    color: var(--text-secondary);
    font-size: 0.9rem;
  }
  
  .category-card:hover .category-icon {
    transform: scale(1.1);
    transition: transform var(--transition-base);
  }
</style>
